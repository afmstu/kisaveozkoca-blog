document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("adminToggle"),t=document.getElementById("adminLoginModal");if("undefined"==typeof supabase)return console.error("Supabase is not loaded!"),void alert("Supabase yüklenemedi!");const n=supabase.createClient("https://xdjyeicdaemdjqntdwsy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhkanllaWNkYWVtZGpxbnRkd3N5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE3MzAyNDksImV4cCI6MjA2NzMwNjI0OX0.uoUGaNtWtfj_sYLKZdZuwFQX4I79BfYGYLxJ463Hb5Y");let o=!1;window.isAdmin=!1,e?e.addEventListener("click",function(){if(o)!async function(){try{const{error:e}=await n.auth.signOut();if(e)return console.error("Sign out error:",e),void alert("Çıkış yapılırken hata oluştu");o=!1,window.isAdmin=!1,a(),alert("Admin çıkışı yapıldı!")}catch(e){console.error("Sign out error:",e),alert("Çıkış yapılırken hata oluştu")}}();else if(t){t.style.display="block",t.classList.add("show"),t.setAttribute("aria-hidden","false"),document.body.classList.add("modal-open");const n=document.createElement("div");n.className="modal-backdrop fade show",n.style.position="fixed",n.style.top="0",n.style.left="0",n.style.width="100vw",n.style.height="100vh",n.style.backgroundColor="rgba(0, 0, 0, 0.5)",n.style.zIndex="1040",document.body.appendChild(n),n.addEventListener("click",function(){e()});const o=t.querySelector(".btn-close");o&&o.addEventListener("click",function(){e()})}function e(){t.style.display="none",t.classList.remove("show"),t.setAttribute("aria-hidden","true"),document.body.classList.remove("modal-open");const e=document.querySelector(".modal-backdrop");e&&e.remove()}}):console.error("Admin toggle button not found!");const i=document.getElementById("adminLoginForm");function a(){const t=document.getElementById("adminPostForm");o?(t&&(t.style.display="block"),e.innerHTML='<i class="fas fa-user-shield"></i>',e.classList.add("admin-active"),e.title="Admin (Çıkış için tıklayın)"):(t&&(t.style.display="none"),e.innerHTML='<i class="fas fa-crown"></i>',e.classList.remove("admin-active"),e.title="Admin Girişi")}i&&i.addEventListener("submit",async function(e){e.preventDefault();const t=document.getElementById("adminEmail").value,s=document.getElementById("adminPassword").value;try{const{data:e,error:d}=await n.auth.signInWithPassword({email:t,password:s});if(d)return console.error("Login error:",d),void alert("Giriş hatası: "+d.message);if(e.user){const{data:t,error:s}=await n.from("admin_users").select("is_admin").eq("id",e.user.id).single();if(s)return console.error("Admin check error:",s),void alert("Admin yetkisi kontrol edilemedi");t&&t.is_admin?(o=!0,window.isAdmin=!0,a(),function(){const e=document.getElementById("adminLoginModal");if(e){e.style.display="none",e.classList.remove("show"),e.setAttribute("aria-hidden","true"),document.body.classList.remove("modal-open");const t=document.querySelector(".modal-backdrop");t&&t.remove()}}(),i.reset(),alert("Admin girişi başarılı!")):(alert("Bu kullanıcının admin yetkisi yok!"),await n.auth.signOut())}}catch(e){console.error("Login error:",e),console.error("Error details:",{message:e.message,code:e.code,status:e.status,stack:e.stack}),alert("Giriş yapılırken hata oluştu: "+e.message)}}),async function(){try{const{data:{user:e}}=await n.auth.getUser();if(e){const{data:t,error:i}=await n.from("admin_users").select("is_admin").eq("id",e.id).single();!i&&t&&t.is_admin&&(o=!0,window.isAdmin=!0,a())}}catch(e){console.error("Auth check error:",e)}}()});const style=document.createElement("style");style.textContent="\n  .modal.show {\n    display: block !important;\n  }\n  \n  .modal-backdrop {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background-color: rgba(0, 0, 0, 0.5);\n    z-index: 1040;\n  }\n  \n  .modal-open {\n    overflow: hidden;\n  }\n",document.head.appendChild(style);